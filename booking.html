<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Booking Consultation | Cognitio +</title>
    <meta name="description" content="Cognitio + | Your Partner in Resilience. Rooted in Culture. Powered by Technology.">
    <link rel="stylesheet" href="booking-style.css">
    <link rel="manifest" href="booking-manifest.json">
    <link rel="icon" href="favicon.ico">
    <meta name="theme-color" content="#2a3142">
</head>
<body>
    <header>
        <h1>Book an Appointment</h1>
        <nav>
            <a href="/">Home</a>
            <a href="/services.html">Services</a>
            <a href="/contact.html">Contact</a>
        </nav>
    </header>

    <main>
        <form id="bookingForm" aria-labelledby="bookingFormTitle" autocomplete="on" novalidate>
            <h2 id="bookingFormTitle">Booking Form</h2>
            
            <!-- Section I: Personal Information -->
            <fieldset>
                <legend>I. Personal Information</legend>
                <label for="fullName">Full Name*</label>
                <input type="text" id="fullName" name="fullName" required aria-required="true" autocomplete="name">
                
                <label for="email">Email Address*</label>
                <input type="email" id="email" name="email" required aria-required="true" autocomplete="email">
                
                <label for="phone">Phone Number*</label>
                <input type="tel" id="phone" name="phone" required aria-required="true" autocomplete="tel" pattern="^\+?[0-9\s\-]{7,15}$" 
                    title="Please enter a valid phone number.">
                
                <label for="dob">Date of Birth*</label>
                <input type="date" id="dob" name="dob" required aria-required="true" max="2020-01-01">
            </fieldset>
            
            <!-- Section II: Service Type -->
            <fieldset>
                <legend>II. Service Type</legend>
                <label for="serviceType">Service*</label>
                <select id="serviceType" name="serviceType" required aria-required="true">
                    <option value="">Select a service</option>
                    <option value="consultation">Psychiatric Consultation</option>
                    <option value="therapy">Talk Therapy</option>
                    <option value="SPSS">Specialist Psychosocial Support</option>
                    <option value="SPS Rehab">Specialist Psychosocial Rehab and Recovey Support</option>
                    <option value="coaching">Resilience Coaching</option>
                </select>
            </fieldset>
            
            <!-- Section III: Session Duration -->
            <fieldset>
                <legend>III. Session Duration</legend>
                <label for="duration">Duration (minutes)*</label>
                <input type="number" id="duration" name="duration" required aria-required="true" min="30" max="180" step="15" value="60">
            </fieldset>
            
            <!-- Section IV: Date & Time -->
            <fieldset>
                <legend>IV. Appointment Date & Time</legend>
                <label for="appointmentDate">Date*</label>
                <input type="date" id="appointmentDate" name="appointmentDate" required aria-required="true" min="">
                
                <label for="appointmentTime">Time*</label>
                <input type="time" id="appointmentTime" name="appointmentTime" required aria-required="true">
            </fieldset>
            
            <!-- Section V: Concerns -->
            <fieldset>
                <legend>V. Briefly Describe Your Concerns</legend>
                <label for="concerns">Your Concerns*</label>
                <textarea id="concerns" name="concerns" required aria-required="true" placeholder="E.g. stress, anxiety, relationship, etc."></textarea>
            </fieldset>
            
            <!-- Section VI: Price Calculation -->
            <fieldset>
                <legend>VI. Price Calculation</legend>
                <p>
                    <strong>Price Policy:</strong>  
                    <br>Base price: ₱800 for the first hour.  
                    <br>Additional minutes: ₱200 per minute.
                </p>
                <label for="calculatedPrice">Calculated Price</label>
                <output id="calculatedPrice" name="calculatedPrice" for="duration">₱800</output>
            </fieldset>
            
            <!-- Section VII: Goals for Consultation / Therapy -->
            <fieldset>
                <legend>VII. Goals for Consultation / Therapy</legend>
                <label for="goals">Your Goals</label>
                <textarea id="goals" name="goals" rows="3" placeholder="State your goals for this session (optional)"></textarea>
            </fieldset>
            
            <!-- Section VIII: Consent & Policy Agreement -->
            <fieldset>
                <legend>VIII. Consent & Policy Agreement</legend>
                <input type="checkbox" id="consent" name="consent" required aria-required="true">
                <label for="consent">
                    I consent to the collection and processing of my personal data in accordance with the
                    <a href="/privacy-policy.html" target="_blank">Privacy Policy</a> and <a href="/terms.html" target="_blank">Terms of Service</a>.
                </label>
            </fieldset>
            
            <!-- Error Message -->
            <div id="errorMsg" role="alert" aria-live="assertive"></div>
            
            <!-- Submit Button -->
            <button type="submit" id="submitBtn">Book Now</button>
        </form>
    </main>

    <!-- Service Worker Registration -->
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register("booking-sw.js")
            .then(reg => {
                console.log('Service Worker registered:', reg.scope);
            })
            .catch(err => {
                document.getElementById('errorMsg').textContent = 
                    'Offline features are unavailable: Service Worker registration failed.';
                console.error('Service Worker registration failed:', err);
            });
        });
    }
    </script>
  
    <!-- Dynamic Price Calculation & Form Validation -->
    <script>
    // Set min date for appointment (today)
    document.addEventListener('DOMContentLoaded', () => {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('appointmentDate').setAttribute('min', today);

        // Dynamic price calculation
        const durationInput = document.getElementById('duration');
        const priceOutput = document.getElementById('calculatedPrice');
        function calculatePrice() {
            let duration = parseInt(durationInput.value, 10) || 60;
            let base = 800;
            let extra = duration > 75 ? (duration - 75) * 200 : 0;
            let total = base + extra;
            priceOutput.value = ` ₱{total.toFixed(2)}`;
            priceOutput.textContent = `₱{total.toFixed(2)}`;
        }
        durationInput.addEventListener('input', calculatePrice);
        calculatePrice();

        // Form validation
        const bookingForm = document.getElementById('bookingForm');
        bookingForm.addEventListener('submit', function(e) {
            e.preventDefault();
            let valid = true;
            let errorMsg = '';

            // Required fields
            const requiredFields = [
                'fullName', 'email', 'phone', 'dob', 
                'serviceType', 'duration', 'appointmentDate', 
                'appointmentTime', 'concerns', 'consent'
            ];
            requiredFields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field.type === 'checkbox' && !field.checked) {
                    valid = false;
                    errorMsg = 'Please agree to the consent and policy.';
                } else if (!field.value) {
                    valid = false;
                    errorMsg = 'Please fill out all required fields.';
                }
            });

            // Email validation
            const email = document.getElementById('email').value;
            if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) {
                valid = false;
                errorMsg = 'Please enter a valid email address.';
            }

            // Phone validation
            const phone = document.getElementById('phone').value;
            if (phone && !/^\+?[0-9\s\-]{7,15}$/.test(phone)) {
                valid = false;
                errorMsg = 'Please enter a valid phone number.';
            }

            if (!valid) {
                document.getElementById('errorMsg').textContent = errorMsg;
                return;
            }

            // If valid, submit (simulate submission here)
            document.getElementById('errorMsg').textContent = '';
            bookingForm.reset();
            calculatePrice();
            alert('Your appointment has been booked! We will contact you soon.');
        });
    });
    </script>
</body>
</html>
